<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<!--/*  Onboarding + API Key Modal - shown in PROD mode when user hasn't provided a valid API key  */-->
<div th:fragment="apikeyModal" id="apikey-modal" class="fixed inset-0 z-[100] hidden">

	<!--/*  Hidden i18n messages for JavaScript  */-->
	<div class="hidden">
		<span data-i18n="apikey.error.required" th:text="#{apikey.error.required}"></span>
		<span data-i18n="apikey.error.invalidFormat" th:text="#{apikey.error.invalidFormat}"></span>
		<span data-i18n="apikey.error.invalid" th:text="#{apikey.error.invalid}"></span>
		<span data-i18n="apikey.error.rateLimited" th:text="#{apikey.error.rateLimited}"></span>
		<span data-i18n="apikey.error.network" th:text="#{apikey.error.network}"></span>
		<span data-i18n="apikey.modal.validating" th:text="#{apikey.modal.validating}"></span>
	</div>

	<!--/*  Backdrop  */-->
	<div class="absolute inset-0 bg-black/95 backdrop-blur-sm"></div>

	<!--/*  Modal Content - Full screen friendly layout  */-->
	<div class="relative z-10 flex items-center justify-center min-h-screen p-4 md:p-8">
		<div class="bg-slate-800 rounded-2xl shadow-2xl border border-slate-700 w-full max-w-6xl overflow-hidden">

			<!--/*  Header with Progress + Language Switcher  */-->
			<div class="p-4 md:p-6 border-b border-slate-700 flex items-center justify-between">
				<!--/*  Progress Indicator  */-->
				<div class="flex items-center gap-3">
					<div id="onboarding-progress" class="flex items-center gap-2">
						<!--/*  Step 1 dot  */-->
						<button onclick="goToOnboardingStep(1)" class="onboarding-dot flex items-center gap-1.5 px-3 py-1.5 rounded-full transition-all cursor-pointer" data-step="1">
							<span class="w-2 h-2 rounded-full bg-current"></span>
							<span class="text-xs font-medium hidden sm:inline" th:text="#{onboarding.progress.step1}">Welcome</span>
						</button>
						<div class="w-6 h-px bg-slate-600"></div>
						<!--/*  Step 2 dot  */-->
						<button onclick="goToOnboardingStep(2)" class="onboarding-dot flex items-center gap-1.5 px-3 py-1.5 rounded-full transition-all cursor-pointer" data-step="2">
							<span class="w-2 h-2 rounded-full bg-current"></span>
							<span class="text-xs font-medium hidden sm:inline" th:text="#{onboarding.progress.step2}">About</span>
						</button>
						<div class="w-6 h-px bg-slate-600"></div>
						<!--/*  Step 3 dot  */-->
						<button onclick="goToOnboardingStep(3)" class="onboarding-dot flex items-center gap-1.5 px-3 py-1.5 rounded-full transition-all cursor-pointer" data-step="3">
							<span class="w-2 h-2 rounded-full bg-current"></span>
							<span class="text-xs font-medium hidden sm:inline" th:text="#{onboarding.progress.step3}">Activate</span>
						</button>
					</div>
				</div>

				<!--/*  Language Switcher in Modal  */-->
				<th:block th:replace="~{layouts/fragments/language-switcher-modal :: modalLanguageSwitcher}" />
			</div>

			<!--/*  ==================== STEP 1: Welcome ==================== */-->
			<div id="onboarding-step-1" class="onboarding-step">
				<div class="grid grid-cols-1 lg:grid-cols-2 gap-0">

					<!--/*  Left: Logo + Badges  */-->
					<div class="p-6 md:p-8 bg-gradient-to-br from-slate-900 via-slate-900 to-blue-900/30 flex flex-col items-center justify-center text-center">
						<div class="mb-4">
							<img th:src="@{/media/logo.png}" alt="Interview AI" class="h-24 w-auto mx-auto mb-4 drop-shadow-2xl">
						</div>
						<h2 class="text-2xl md:text-3xl font-bold text-white mb-2" th:text="#{onboarding.step1.title}">Welcome to Interview AI</h2>
						<p class="text-slate-400 text-sm mb-6" th:text="#{onboarding.step1.subtitle}">Your personal AI-powered interview coach</p>

						<!--/*  Trust badges  */-->
						<div class="flex items-center gap-4">
							<span class="inline-flex items-center gap-1.5 px-3 py-1.5 bg-green-500/10 border border-green-500/30 rounded-full text-green-400 text-xs font-medium">
								<i class="fa-solid fa-check-circle"></i>
								<span th:text="#{onboarding.step1.free}">100% Free</span>
							</span>
							<span class="inline-flex items-center gap-1.5 px-3 py-1.5 bg-blue-500/10 border border-blue-500/30 rounded-full text-blue-400 text-xs font-medium">
								<i class="fa-solid fa-clock"></i>
								<span th:text="#{onboarding.step1.time}">Ready in 2 min</span>
							</span>
						</div>
					</div>

					<!--/*  Right: Features + CTA  */-->
					<div class="p-6 md:p-8 flex flex-col justify-center">
						<div class="space-y-4 mb-6">
							<!--/*  Feature 1: Voice  */-->
							<div class="flex items-start gap-4 p-3 rounded-xl bg-slate-700/20 hover:bg-slate-700/40 transition-colors onboarding-feature" style="animation-delay: 0.1s">
								<div class="w-10 h-10 rounded-xl bg-gradient-to-br from-blue-500 to-cyan-500 flex items-center justify-center flex-shrink-0">
									<i class="fa-solid fa-microphone text-white"></i>
								</div>
								<div>
									<h3 class="text-white font-semibold text-sm" th:text="#{onboarding.step1.feature1.title}">Voice Conversations</h3>
									<p class="text-slate-400 text-xs mt-0.5" th:text="#{onboarding.step1.feature1.desc}">Talk naturally with your AI interviewer</p>
								</div>
							</div>
							<!--/*  Feature 2: Feedback  */-->
							<div class="flex items-start gap-4 p-3 rounded-xl bg-slate-700/20 hover:bg-slate-700/40 transition-colors onboarding-feature" style="animation-delay: 0.2s">
								<div class="w-10 h-10 rounded-xl bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center flex-shrink-0">
									<i class="fa-solid fa-chart-line text-white"></i>
								</div>
								<div>
									<h3 class="text-white font-semibold text-sm" th:text="#{onboarding.step1.feature2.title}">Smart Feedback</h3>
									<p class="text-slate-400 text-xs mt-0.5" th:text="#{onboarding.step1.feature2.desc}">Get detailed scores and tips to improve</p>
								</div>
							</div>
							<!--/*  Feature 3: Personalized  */-->
							<div class="flex items-start gap-4 p-3 rounded-xl bg-slate-700/20 hover:bg-slate-700/40 transition-colors onboarding-feature" style="animation-delay: 0.3s">
								<div class="w-10 h-10 rounded-xl bg-gradient-to-br from-orange-500 to-yellow-500 flex items-center justify-center flex-shrink-0">
									<i class="fa-solid fa-file-lines text-white"></i>
								</div>
								<div>
									<h3 class="text-white font-semibold text-sm" th:text="#{onboarding.step1.feature3.title}">Personalized Questions</h3>
									<p class="text-slate-400 text-xs mt-0.5" th:text="#{onboarding.step1.feature3.desc}">Upload your CV and the AI tailors questions</p>
								</div>
							</div>
						</div>

						<!--/*  CTA Button  */-->
						<button type="button" onclick="goToOnboardingStep(2)"
								class="btn-glow w-full px-6 py-4 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-500 hover:to-purple-500 text-white font-bold text-lg rounded-xl flex items-center justify-center gap-3 transition-all shadow-lg shadow-blue-500/25 hover:shadow-blue-500/40 hover:scale-[1.02] active:scale-[0.98]">
							<span th:text="#{onboarding.step1.cta}">Get Started</span>
							<i class="fa-solid fa-arrow-right"></i>
						</button>
					</div>
				</div>
			</div>

			<!--/*  ==================== STEP 2: Activate Free Account ==================== */-->
			<div id="onboarding-step-2" class="onboarding-step hidden">
				<div class="grid grid-cols-1 lg:grid-cols-2 gap-0">

					<!--/*  Left: Visual + Reassurance  */-->
					<div class="p-6 md:p-8 bg-gradient-to-br from-slate-900 via-slate-900 to-green-900/20 flex flex-col items-center justify-center text-center">
						<div class="w-20 h-20 rounded-2xl bg-gradient-to-br from-green-500 to-emerald-600 flex items-center justify-center mb-5 shadow-lg shadow-green-500/30">
							<i class="fa-solid fa-shield-halved text-4xl text-white"></i>
						</div>
						<h2 class="text-2xl md:text-3xl font-bold text-white mb-2" th:text="#{onboarding.step2.title}">Activate Your Free Account</h2>
						<p class="text-slate-400 text-sm mb-6" th:text="#{onboarding.step2.subtitle}">One quick setup to unlock your personal AI interviewer</p>

						<!--/*  Benefits list  */-->
						<div class="space-y-2.5 text-left w-full max-w-sm">
							<div class="flex items-center gap-3 text-sm">
								<i class="fa-solid fa-circle-check text-green-400 flex-shrink-0"></i>
								<span class="text-slate-300" th:text="#{onboarding.step2.benefit1}">Completely free â€” no credit card needed</span>
							</div>
							<div class="flex items-center gap-3 text-sm">
								<i class="fa-solid fa-circle-check text-green-400 flex-shrink-0"></i>
								<span class="text-slate-300" th:text="#{onboarding.step2.benefit2}">Only takes about 2 minutes</span>
							</div>
							<div class="flex items-center gap-3 text-sm">
								<i class="fa-solid fa-circle-check text-green-400 flex-shrink-0"></i>
								<span class="text-slate-300" th:text="#{onboarding.step2.benefit3}">Just need a Google account (Gmail)</span>
							</div>
							<div class="flex items-center gap-3 text-sm">
								<i class="fa-solid fa-circle-check text-green-400 flex-shrink-0"></i>
								<span class="text-slate-300" th:text="#{onboarding.step2.benefit4}">Your pass is stored safely in your browser</span>
							</div>
						</div>
					</div>

					<!--/*  Right: Explanation + CTA  */-->
					<div class="p-6 md:p-8 flex flex-col justify-center">
						<div class="mb-6">
							<h3 class="text-white font-semibold mb-3 flex items-center gap-2">
								<i class="fa-solid fa-lightbulb text-yellow-400"></i>
								<span th:text="#{onboarding.step2.how.title}">How it works</span>
							</h3>
							<p class="text-slate-400 text-sm leading-relaxed" th:text="#{onboarding.step2.how.desc}">
								This app uses Google's Gemini AI to power your interviews. To give you unlimited free access, we just need you to grab a personal pass from Google.
							</p>
						</div>

						<!--/*  Collapsible "Why do I need this?"  */-->
						<div class="mb-6">
							<button type="button" onclick="toggleOnboardingFaq()" class="flex items-center gap-2 text-sm text-slate-500 hover:text-slate-300 transition-colors">
								<i id="onboarding-faq-icon" class="fa-solid fa-chevron-right text-xs transition-transform"></i>
								<span th:text="#{onboarding.step2.whyNeeded}">Why do I need this?</span>
							</button>
							<div id="onboarding-faq-content" class="hidden mt-2 pl-5 text-xs text-slate-500 leading-relaxed">
								<span th:text="#{onboarding.step2.whyExplanation}">Google provides a free personal pass for their AI. This keeps the app free for everyone while giving you your own private connection.</span>
							</div>
						</div>

						<!--/*  Navigation Buttons  */-->
						<div class="flex gap-3">
							<button type="button" onclick="goToOnboardingStep(1)"
									class="px-5 py-4 bg-slate-700 hover:bg-slate-600 text-white font-medium rounded-xl flex items-center justify-center gap-2 transition-all">
								<i class="fa-solid fa-arrow-left"></i>
							</button>
							<button type="button" onclick="goToOnboardingStep(3)"
									class="btn-glow-green flex-1 px-6 py-4 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-500 hover:to-emerald-500 text-white font-bold text-lg rounded-xl flex items-center justify-center gap-3 transition-all shadow-lg shadow-green-500/25 hover:shadow-green-500/40 hover:scale-[1.01] active:scale-[0.98]">
								<span th:text="#{onboarding.step2.cta}">Let's Do It</span>
								<i class="fa-solid fa-arrow-right"></i>
							</button>
						</div>
					</div>
				</div>
			</div>

			<!--/*  ==================== STEP 3: API Key Setup ==================== */-->
			<div id="onboarding-step-3" class="onboarding-step hidden">
				<!--/*  Step 3 Header (inside the body area)  */-->
				<div class="px-4 md:px-6 pt-4 md:pt-5 pb-2 flex items-center gap-4">
					<button type="button" onclick="goToOnboardingStep(2)"
							class="w-10 h-10 rounded-xl bg-slate-700 hover:bg-slate-600 flex items-center justify-center text-slate-300 hover:text-white transition-colors flex-shrink-0">
						<i class="fa-solid fa-arrow-left"></i>
					</button>
					<div>
						<h2 class="text-xl md:text-2xl font-bold text-white" th:text="#{onboarding.step3.title}">Get Your Free Pass</h2>
						<p class="text-slate-400 text-sm" th:text="#{onboarding.step3.subtitle}">Follow the video or the steps below</p>
					</div>
				</div>

				<!--/*  Body - Two Column Layout (existing API key setup)  */-->
				<div class="grid grid-cols-1 lg:grid-cols-2 gap-0 lg:gap-6">

					<!--/*  Left Column: Video Tutorial  */-->
					<div class="p-4 md:p-6 bg-slate-900/50 lg:rounded-bl-2xl">
						<h3 class="text-white font-semibold mb-3 flex items-center gap-2">
							<i class="fa-solid fa-play-circle text-green-400"></i>
							<span th:text="#{apikey.modal.watchTutorial}">Video Tutorial</span>
							<span class="text-xs text-slate-500 ml-2">(30 sec)</span>
						</h3>
						<div class="rounded-xl overflow-hidden border border-slate-600 bg-black">
							<video id="tutorial-video" class="w-full" controls loop muted playsinline>
								<source src="/media/generate_key_tutorial.mp4" type="video/mp4">
							</video>
						</div>

						<!--/*  Quick Link Button under video  */-->
						<a href="https://aistudio.google.com/app/apikey" target="_blank" rel="noopener noreferrer"
								class="btn-glow mt-4 w-full px-6 py-3 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-500 hover:to-purple-500 text-white font-semibold rounded-xl flex items-center justify-center gap-2 transition-all shadow-lg shadow-blue-500/25">
							<i class="fa-solid fa-rocket"></i>
							<span th:text="#{apikey.modal.openStudio}">Get My Free Pass</span>
						</a>
					</div>

					<!--/*  Right Column: Steps + Input  */-->
					<div class="p-4 md:p-6 flex flex-col">

						<!--/*  Compact Steps  */-->
						<div class="mb-4">
							<h3 class="text-white font-semibold mb-3 flex items-center gap-2">
								<i class="fa-solid fa-list-check text-blue-400"></i>
								<span th:text="#{apikey.modal.stepByStep}">Quick Steps</span>
							</h3>
							<div class="grid grid-cols-2 gap-2 text-sm">
								<div class="flex items-center gap-2 p-2 bg-slate-700/30 rounded-lg">
									<span class="w-5 h-5 rounded-full bg-blue-500 text-white text-xs flex items-center justify-center font-bold">1</span>
									<span class="text-slate-300" th:text="#{apikey.modal.step1Short}">Open link below</span>
								</div>
								<div class="flex items-center gap-2 p-2 bg-slate-700/30 rounded-lg">
									<span class="w-5 h-5 rounded-full bg-blue-500 text-white text-xs flex items-center justify-center font-bold">2</span>
									<span class="text-slate-300" th:text="#{apikey.modal.step2Short}">Sign in with Google</span>
								</div>
								<div class="flex items-center gap-2 p-2 bg-slate-700/30 rounded-lg">
									<span class="w-5 h-5 rounded-full bg-blue-500 text-white text-xs flex items-center justify-center font-bold">3</span>
									<span class="text-slate-300" th:text="#{apikey.modal.step3Short}">Create API Key</span>
								</div>
								<div class="flex items-center gap-2 p-2 bg-slate-700/30 rounded-lg">
									<span class="w-5 h-5 rounded-full bg-blue-500 text-white text-xs flex items-center justify-center font-bold">4</span>
									<span class="text-slate-300" th:text="#{apikey.modal.step4Short}">Create project</span>
								</div>
								<div class="flex items-center gap-2 p-2 bg-slate-700/30 rounded-lg">
									<span class="w-5 h-5 rounded-full bg-blue-500 text-white text-xs flex items-center justify-center font-bold">5</span>
									<span class="text-slate-300" th:text="#{apikey.modal.step5Short}">Click Create key</span>
								</div>
								<div class="flex items-center gap-2 p-2 bg-green-500/20 rounded-lg border border-green-500/30">
									<span class="w-5 h-5 rounded-full bg-green-500 text-white text-xs flex items-center justify-center font-bold">6</span>
									<span class="text-green-300" th:text="#{apikey.modal.step6Short}">Copy & paste here</span>
								</div>
							</div>
						</div>

						<!--/*  API Key Input Section  */-->
						<div class="flex-1 flex flex-col justify-end">
							<div class="bg-slate-700/50 rounded-xl p-4 border-2 border-dashed border-slate-600">
								<label class="block text-sm font-medium text-slate-300 mb-2" th:text="#{apikey.modal.inputLabel}">
									Paste your API key here
								</label>
								<div class="flex gap-2">
									<div class="relative flex-1">
										<input type="password" id="apikey-input"
												th:placeholder="#{apikey.modal.inputPlaceholder}"
												placeholder="AIza..."
												class="w-full px-4 py-3 bg-slate-900 border-2 border-slate-600 rounded-xl text-white font-mono text-lg focus:outline-none focus:border-blue-500 transition-colors pr-12"
												autocomplete="off" spellcheck="false">
										<button type="button" onclick="toggleApiKeyVisibility()"
												class="absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 hover:text-white transition-colors">
											<i id="apikey-visibility-icon" class="fa-solid fa-eye text-lg"></i>
										</button>
									</div>
								</div>

								<!--/*  Error message  */-->
								<div id="apikey-error" class="hidden mt-3 p-3 bg-red-500/20 border border-red-500/50 rounded-xl">
									<p class="text-red-400 text-sm flex items-center gap-2">
										<i class="fa-solid fa-exclamation-circle"></i>
										<span id="apikey-error-text">Invalid API key</span>
									</p>
								</div>

								<!--/*  Success message  */-->
								<div id="apikey-success" class="hidden mt-3 p-3 bg-green-500/20 border border-green-500/50 rounded-xl">
									<p class="text-green-400 text-sm flex items-center gap-2">
										<i class="fa-solid fa-check-circle"></i>
										<span th:text="#{apikey.modal.success}">API key validated successfully!</span>
									</p>
								</div>

								<!--/*  Submit Button  */-->
								<button type="button" id="apikey-submit-btn" onclick="validateAndSaveApiKey()"
										class="mt-4 w-full px-6 py-4 bg-green-600 hover:bg-green-500 disabled:bg-slate-600 disabled:cursor-not-allowed text-white font-bold text-lg rounded-xl flex items-center justify-center gap-3 transition-all shadow-lg shadow-green-500/25">
									<i id="apikey-submit-icon" class="fa-solid fa-check text-xl"></i>
									<span id="apikey-submit-text" th:text="#{apikey.modal.submitButton}">Verify & Continue</span>
								</button>
							</div>

							<!--/*  Info note  */-->
							<p class="text-center text-slate-500 text-xs mt-3">
								<i class="fa-solid fa-shield-halved mr-1"></i>
								<span th:text="#{apikey.modal.securityNote}">Your API key is stored only in your browser</span>
							</p>
						</div>
					</div>
				</div>
			</div>

		</div>
	</div>
</div>

<!--/*  Rate Limit Modal  */-->
<div th:fragment="rateLimitModal" id="ratelimit-modal" class="fixed inset-0 z-[100] hidden">
	<div class="absolute inset-0 bg-black/90 backdrop-blur-sm"></div>
	<div class="relative z-10 flex items-center justify-center min-h-screen p-4">
		<div class="bg-slate-800 rounded-2xl shadow-2xl border border-red-500/50 max-w-md w-full p-6 text-center">
			<div class="w-16 h-16 mx-auto rounded-full bg-red-500/20 flex items-center justify-center mb-4">
				<i class="fa-solid fa-exclamation-triangle text-3xl text-red-400"></i>
			</div>
			<h2 class="text-xl font-bold text-white mb-2" th:text="#{apikey.modal.rateLimitTitle}">Rate Limit Reached</h2>
			<p class="text-slate-400 mb-6" th:text="#{apikey.modal.rateLimitMessage}">Your API key has reached its usage limit.</p>
			<button type="button" onclick="clearApiKeyAndShowModal()"
					class="w-full px-6 py-3 bg-blue-600 hover:bg-blue-500 text-white font-semibold rounded-xl transition-all">
				<i class="fa-solid fa-key mr-2"></i>
				<span th:text="#{apikey.modal.enterNewKey}">Enter New API Key</span>
			</button>
		</div>
	</div>
</div>

</html>
